{% extends 'base.html' %}
{% block title %}Register â€¢ Arena Invicta{% endblock %}

{% block content %}
<section class="min-h-[80vh] flex flex-col justify-center items-center px-4 py-10">
  
  <div class="w-full max-w-[500px]">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-extrabold tracking-tight text-white drop-shadow-lg">
        Join the <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">Arena</span>
      </h1>
      <p class="text-gray-400 mt-2 text-sm">Create your profile and start competing.</p>
    </div>

    <form method="post"
          class="bg-[#2A1B54]/80 backdrop-blur-xl border border-white/10 rounded-3xl shadow-[0_0_50px_rgba(147,51,234,0.15)] p-8 md:p-10 space-y-5 relative overflow-hidden">
      
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="rounded-xl border border-red-500/30 bg-red-500/10 text-red-200 px-4 py-3 text-sm">
          {% for e in form.non_field_errors %}<p>{{ e }}</p>{% endfor %}
        </div>
      {% endif %}

      <div class="space-y-1">
        <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="{{ form.username.id_for_label }}">Username</label>
        {{ form.username }}
        {% for e in form.username.errors %}<p class="mt-1 text-xs text-red-400 pl-1">{{ e }}</p>{% endfor %}
      </div>

      <div class="space-y-1">
        <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="{{ form.password1.id_for_label }}">Password</label>
        <div class="relative">
          {{ form.password1 }}
          <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition p-1" data-toggle-password data-target="#{{ form.password1.id_for_label }}">
            <svg class="w-5 h-5 eye" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/><circle cx="12" cy="12" r="3" stroke-width="2"/></svg>
            <svg class="w-5 h-5 eye-off hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 3l18 18M10.6 5.1A10.6 10.6 0 0112 5c7 0 11 7 11 7a17.7 17.7 0 01-3.6 4.5M7 7C2.8 9 1 12 1 12s4 7 11 7a10.8 10.8 0 004.1-.8"/><path stroke-width="2" d="M9 9a3 3 0 104.2 4.2"/></svg>
          </button>
        </div>
        {% for e in form.password1.errors %}<p class="mt-1 text-xs text-red-400 pl-1">{{ e }}</p>{% endfor %}
      </div>

      <div class="space-y-1">
        <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="{{ form.password2.id_for_label }}">Confirm Password</label>
        <div class="relative">
          {{ form.password2 }}
          <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-white transition p-1" data-toggle-password data-target="#{{ form.password2.id_for_label }}">
            <svg class="w-5 h-5 eye" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/><circle cx="12" cy="12" r="3" stroke-width="2"/></svg>
            <svg class="w-5 h-5 eye-off hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 3l18 18M10.6 5.1A10.6 10.6 0 0112 5c7 0 11 7 11 7a17.7 17.7 0 01-3.6 4.5M7 7C2.8 9 1 12 1 12s4 7 11 7a10.8 10.8 0 004.1-.8"/><path stroke-width="2" d="M9 9a3 3 0 104.2 4.2"/></svg>
          </button>
        </div>
        {% for e in form.password2.errors %}<p class="mt-1 text-xs text-red-400 pl-1">{{ e }}</p>{% endfor %}
      </div>

      <div class="space-y-1">
        <label class="text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="{{ form.role.id_for_label }}">Choose Role</label>
        <div class="relative">
            {{ form.role }}
            <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
            </div>
        </div>
        {% for e in form.role.errors %}<p class="mt-1 text-xs text-red-400 pl-1">{{ e }}</p>{% endfor %}
      </div>

      <button class="w-full rounded-xl py-4 font-bold text-white tracking-wide shadow-lg mt-6
                     bg-gradient-to-r from-primary to-secondary hover:shadow-[0_0_30px_rgba(236,72,153,0.4)] transition-all transform hover:-translate-y-1 active:scale-95"
              type="submit">
        CREATE ACCOUNT
      </button>
    </form>

    <p class="mt-8 text-center text-sm text-gray-400">
      Already have an account?
      <a class="font-bold text-white hover:text-secondary underline decoration-secondary/50 decoration-2 underline-offset-4 transition" href="{% url 'accounts:login' %}">Login</a>
    </p>
  </div>
</section>

<style type="text/tailwindcss">
  @layer base{
    input[type='text'], input[type='password'], select {
      @apply w-full h-12 rounded-xl bg-black/40 border border-white/10 px-4 text-white placeholder-white/20 shadow-inner
             focus:outline-none focus:border-secondary focus:ring-1 focus:ring-secondary transition-all duration-300 appearance-none;
    }
    option {
        background-color: #1A103C;
        color: white;
    }
  }
</style>

<script>
    document.addEventListener('click', function (e) {
    const btn = e.target.closest('[data-toggle-password]'); if (!btn) return;
    const input = document.querySelector(btn.getAttribute('data-target')); if (!input) return;
    const willShow = input.type === 'password';
    input.type = willShow ? 'text' : 'password';
    btn.querySelector('.eye')?.classList.toggle('hidden');
    btn.querySelector('.eye-off')?.classList.toggle('hidden');
  });

  (function setPH(){
    const set = (id, ph) => { const el = document.getElementById(id); if (el && !el.placeholder) el.placeholder = ph; };
    set('{{ form.password1.id_for_label|default_if_none:"" }}','Minimum 8 characters');
    set('{{ form.password2.id_for_label|default_if_none:"" }}','Repeat password');
  })();
</script>
{% endblock %}