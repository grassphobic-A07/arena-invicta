{% extends "base.html" %}
{% block title %}Profile â€¢ Arena Invicta{% endblock %}
{% block content %}
<section class="bg-white rounded-xl border border-mist p-6">
  <h1 class="text-3xl font-semibold text-primary mb-4">Profile</h1>

  <div class="space-y-2 text-surface">
    <p><strong>Username:</strong> {{ request.user.username }}</p>
    <p><strong>Display Name:</strong> {{ profile.display_name|default:"-" }}</p>
    <p><strong>Favourite Team:</strong> {{ profile.favorite_team|default:"-" }}</p>
    <p><strong>Avatar URL:</strong>
      {% if profile.avatar_url %}
        <a class="text-sea underline" href="{{ profile.avatar_url }}" target="_blank">{{ profile.avatar_url }}</a>
      {% else %}-{% endif %}
    </p>
    <p><strong>Bio:</strong><br>{{ profile.bio|linebreaksbr|default:"-" }}</p>
  </div>

  <div class="mt-4 flex flex-wrap gap-2">
    <!-- Perlu diperbaiki -->
    {% if request.user.is_superuser %}
      <span class="inline-block px-2.5 py-1 rounded-full bg-primary text-mist text-xs">Admin</span>
    {% endif %}
    {% for name in roles %}
      <span class="inline-block px-2.5 py-1 rounded-full text-xs
        {% if name == 'Registered' %} bg-sea text-mist
        {% elif name == 'Content Staff' %} bg-mint text-primary
        {% else %} bg-surface/10 text-surface {% endif %}">{{ name }}</span>
    {% empty %}
      <span class="text-surface/70 text-sm">(Tidak ada role)</span>
    {% endfor %}
  </div>

  <div class="mt-6">
    <a href="{% url 'accounts:profile_edit' %}"
       class="inline-block bg-primary text-mist rounded-xl px-4 py-2 hover:bg-sea">Edit Profile</a>
  </div>
</section>

<!-- Toast container -->
<div id="toast-holder" class="fixed top-4 right-4 space-y-2 z-50"></div>

{% if messages %}
<!-- Payload pesan (HTML, bukan JS) -->
<div id="dj-messages" hidden>
  {% for m in messages %}
    <div data-level="{{ m.tags|default:"info" }}" data-text="{{ m|escape }}"></div>
  {% endfor %}
</div>
{% endif %}

<script>
(function () {
  // define showToast kalau belum ada
  window.showToast = window.showToast || function (message, type) {
    const holder = document.getElementById("toast-holder");
    if (!holder) return;
    const el = document.createElement("div");
    const base = "rounded-xl px-4 py-3 shadow-lg text-sm transition-opacity duration-300";
    const tone =
      (type && String(type).includes("success")) ? "bg-mint text-primary" :
      (type && (String(type).includes("error") || String(type).includes("danger"))) ? "bg-danger text-white" :
      "bg-surface text-white";
    el.className = base + " " + tone;
    el.textContent = message;
    holder.appendChild(el);
    setTimeout(() => { el.style.opacity = "0"; }, 2400);
    setTimeout(() => { el.remove(); }, 2800);
  };

  // render semua messages sebagai toast
  document.querySelectorAll("#dj-messages > div")
    .forEach(n => showToast(n.dataset.text, n.dataset.level));
})();
</script>


{% endblock %}

