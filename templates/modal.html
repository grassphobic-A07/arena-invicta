<div id="addNewsModal" 
     class="fixed inset-0 z-[1000] hidden flex items-center justify-center p-4" 
     aria-labelledby="addNewsModalTitle" role="dialog" aria-modal="true">
    
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="hideNewsModal()"></div>

    <div id="addNewsModalContent" 
         class="relative bg-[#2A1B54] bg-opacity-90 backdrop-blur-xl rounded-2xl border border-white/10 shadow-[0_0_50px_rgba(147,51,234,0.3)] w-full max-w-lg max-h-[90vh] flex flex-col transform transition-all duration-300 opacity-0 scale-95">
        
        <div class="flex items-start justify-between p-5 border-b border-white/10">
            <div>
                <h3 id="addNewsModalTitle" class="text-2xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400">
                    Create News
                </h3>
                <p class="text-sm text-gray-400 mt-1 font-light">Share your story with the arena.</p>
            </div>
            <button type="button" 
                    class="p-2 rounded-full text-gray-400 hover:bg-white/10 hover:text-white transition" 
                    onclick="hideNewsModal()">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </div>

        <div class="p-5 space-y-4 overflow-y-auto custom-scrollbar">
            <form id="addNewsForm" method="POST" action="{% url 'news:add_news_ajax' %}" novalidate>
                <div class="group">
                    <label class="block text-xs font-bold text-secondary uppercase tracking-wider mb-1">Headline Title <span class="text-danger">*</span></label>
                    <input type="text" id="modal_title" name="title" 
                           class="w-full rounded-xl bg-black/30 border border-white/10 focus:border-secondary focus:ring-1 focus:ring-secondary px-4 py-3 text-white placeholder-white/30 transition outline-none font-medium" 
                           placeholder="Enter an epic title..." required>
                    <span class="text-xs text-danger mt-1 empty:hidden error-message-title"></span>
                </div>

                <div>
                    <label class="block text-xs font-bold text-secondary uppercase tracking-wider mb-1">Content <span class="text-danger">*</span></label>
                    <textarea id="modal_content" name="content" rows="5" 
                              class="w-full rounded-xl bg-black/30 border border-white/10 focus:border-secondary focus:ring-1 focus:ring-secondary px-4 py-3 text-white placeholder-white/30 transition outline-none resize-none font-light" 
                              placeholder="What's happening in the arena?" required></textarea>
                    <span class="text-xs text-danger mt-1 empty:hidden error-message-content"></span>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-secondary uppercase tracking-wider mb-1">Category</label>
                        <select name="category" class="w-full rounded-xl bg-black/30 border border-white/10 text-white px-4 py-3 focus:border-secondary outline-none appearance-none font-medium">
                             {% for value, display in news_form.fields.category.choices %}
                                <option value="{{ value }}" class="bg-[#2A1B54]">{{ display }}</option>
                             {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-secondary uppercase tracking-wider mb-1">Sport</label>
                        <select name="sports" class="w-full rounded-xl bg-black/30 border border-white/10 text-white px-4 py-3 focus:border-secondary outline-none appearance-none font-medium">
                             {% for value, display in news_form.fields.sports.choices %}
                                <option value="{{ value }}" class="bg-[#2A1B54]">{{ display }}</option>
                             {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="mt-2">
                    <label class="block text-xs font-bold text-secondary uppercase tracking-wider mb-1">Image URL</label>
                    <input type="url" name="thumbnail" 
                        class="w-full rounded-xl bg-black/30 border border-white/10 focus:border-secondary px-4 py-3 text-white placeholder-white/30 transition outline-none font-light" 
                        placeholder="https://...">
                </div>

                <div class="flex items-center gap-3 mt-4 bg-white/5 p-3 rounded-lg border border-white/5">
                    <input id="modal_is_featured" name="is_featured" type="checkbox" 
                           class="h-5 w-5 rounded border-white/20 bg-black/40 text-secondary focus:ring-secondary cursor-pointer">
                    <label for="modal_is_featured" class="text-sm font-medium text-gray-200 cursor-pointer">Mark as Hot News / Featured?</label>
                </div>
            </form>
        </div>

        <div class="flex items-center justify-end gap-3 p-5 border-t border-white/10 bg-black/20">
            <button type="button" 
                    class="px-5 py-2.5 rounded-xl text-sm font-semibold text-gray-300 hover:text-white hover:bg-white/10 transition" 
                    onclick="hideNewsModal()">
                Cancel
            </button>
            <button type="submit" form="addNewsForm" 
                    class="submit-button px-6 py-2.5 rounded-xl text-sm font-bold tracking-wide text-white bg-gradient-to-r from-primary to-secondary hover:shadow-[0_0_20px_rgba(236,72,153,0.4)] transition transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                 <span class="submit-text">PUBLISH</span>
                 <span class="loading-indicator hidden animate-pulse">Processing...</span>
            </button>
        </div>
    </div>
</div>

<script>
    const newsModal = document.getElementById('addNewsModal');
    const newsModalContent = document.getElementById('addNewsModalContent');
    const newsForm = document.getElementById('addNewsForm');
    const newsSubmitButton = newsForm.closest('#addNewsModalContent').querySelector('.submit-button');

    function showNewsModal(){
        newsModal.classList.remove('hidden');
        requestAnimationFrame(() => {
            newsModalContent.classList.remove('opacity-0', 'scale-95');
            newsModalContent.classList.add('opacity-100', 'scale-100');
        });
    }

    function hideNewsModal(){
        newsModalContent.classList.remove('opacity-100', 'scale-100');
        newsModalContent.classList.add('opacity-0', 'scale-95');
        setTimeout(() => {
            newsModal.classList.add('hidden');
        }, 300);
    }

    async function submitNewsForm(){
        const submitText = newsSubmitButton.querySelector('.submit-text');
        const loadingIndicator = newsSubmitButton.querySelector('.loading-indicator');
        newsSubmitButton.disabled = true;
        submitText.classList.add('hidden');
        loadingIndicator.classList.remove('hidden');
        const formData = new FormData(newsForm);
        try{
            const response = await fetch(newsForm.action, { method: "POST", body: formData, headers: {'X-Requested-With': 'XMLHttpRequest'} });
            const data = await response.json();
            if(response.status === 201){
                hideNewsModal();
                showToast('News deployed successfully!', 'success');
                prependNewsCard(data);
                newsForm.reset();
            } else { showToast(data.message || 'Error creating news.', 'error'); }
        } catch(error){ showToast('Connection lost.', 'error'); } finally{
            newsSubmitButton.disabled = false;
            submitText.classList.remove('hidden');
            loadingIndicator.classList.add('hidden');
        }
    }

    function prependNewsCard(newsData) {
        const grid = document.getElementById('news-grid');
        if(!grid) return;
        const cardHTML = `
        <a href="${newsData.detail_url}" class="group relative block rounded-2xl overflow-hidden bg-[#2A1B54] border border-white/5 shadow-lg hover:shadow-primary/40 hover:-translate-y-1 transition-all duration-300">
            <div class="h-48 w-full bg-cover bg-center relative" style="background-image: url('${newsData.thumbnail || 'https://via.placeholder.com/400x200?text=Arena+Invicta'}');">
                <div class="absolute inset-0 bg-gradient-to-t from-[#2A1B54] via-transparent to-transparent"></div>
                <span class="absolute top-3 left-3 bg-secondary/80 text-white text-[10px] font-bold px-2 py-1 rounded backdrop-blur-md uppercase tracking-wider font-sans">
                    ${newsData.category_display}
                </span>
            </div>
            <div class="p-4 relative">
                <h3 class="text-lg font-bold text-white leading-tight group-hover:text-secondary transition line-clamp-2">
                    ${newsData.title}
                </h3>
                <div class="mt-3 flex items-center justify-between text-xs text-gray-400 font-medium">
                    <span>Just now</span>
                    <span class="flex items-center gap-1"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></path></svg> 0</span>
                </div>
            </div>
        </a>`;
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = cardHTML;
        grid.prepend(tempDiv.firstElementChild);
    }
    newsForm.addEventListener("submit", function(e){ e.preventDefault(); submitNewsForm(); });
</script>