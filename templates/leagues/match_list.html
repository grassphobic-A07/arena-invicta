{% extends 'base.html' %}
{% block title %}Daftar Pertandingan • Premier League{% endblock %}

{% block content %}
<section class="mx-auto max-w-7xl px-4 py-8 space-y-8">
  
  <div>
    <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-white via-primary to-secondary drop-shadow-[0_0_15px_rgba(147,51,234,0.5)] mb-4">
      Premier League — Matches
    </h1>
    {% include 'leagues/_league_nav.html' with league=league current_nav='matches' %}
  </div>

  <div class="flex items-center gap-2 mb-4 bg-black/20 p-1.5 rounded-full inline-flex border border-white/10" role="tablist" aria-label="Filter Pertandingan">
    {% with base_path=request.path %}
      <a href="{{ base_path }}?tab=all"
         class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 
         {% if active_tab == 'all' %} bg-primary text-white shadow-lg shadow-primary/30 {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}">
        All
      </a>
      <a href="{{ base_path }}?tab=finished"
         class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300
         {% if active_tab == 'finished' %} bg-secondary text-white shadow-lg shadow-secondary/30 {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}">
        Finished
      </a>
      <a href="{{ base_path }}?tab=upcoming"
         class="px-6 py-2 rounded-full text-sm font-bold transition-all duration-300
         {% if active_tab == 'upcoming' %} bg-green-500 text-white shadow-lg shadow-green-500/30 {% else %} text-gray-400 hover:text-white hover:bg-white/5 {% endif %}">
        Upcoming
      </a>
    {% endwith %}
  </div>

  <form class="bg-[#2A1B54]/40 backdrop-blur-md border border-white/10 rounded-2xl p-4 flex flex-wrap items-center gap-4 shadow-lg" method="get" action="">
    <input type="hidden" name="tab" value="{{ active_tab }}">
    
    <div class="relative flex-1 min-w-[200px]">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        </div>
        <input type="text" name="team" value="{{ team_q }}" placeholder="Search team (e.g. Arsenal)"
               class="w-full h-11 rounded-xl bg-black/30 border border-white/10 pl-10 pr-4 text-white focus:border-secondary focus:ring-1 focus:ring-secondary outline-none transition placeholder-gray-500">
    </div>

    <div class="flex items-center gap-2">
        <input type="date" name="from" value="{{ from_q }}" aria-label="Tanggal mulai"
               class="h-11 rounded-xl bg-black/30 border border-white/10 px-4 text-gray-300 focus:border-secondary outline-none transition cursor-pointer">
        <span class="text-gray-500">-</span>
        <input type="date" name="to" value="{{ to_q }}" aria-label="Tanggal akhir"
               class="h-11 rounded-xl bg-black/30 border border-white/10 px-4 text-gray-300 focus:border-secondary outline-none transition cursor-pointer">
    </div>

    <button type="submit"
            class="h-11 px-6 rounded-xl bg-gradient-to-r from-primary to-secondary text-white font-bold shadow-lg hover:shadow-primary/30 transition transform hover:-translate-y-0.5">
      Apply
    </button>
    
    <a href="?tab={{ active_tab }}"
       class="h-11 px-4 inline-flex items-center rounded-xl border border-white/10 text-gray-400 hover:bg-white/10 hover:text-white transition font-medium">
      Reset
    </a>
  </form>

  {% if request.user.is_authenticated and request.user.profile.is_content_staff %}
    <div class="flex justify-end">
      <a href="{% url 'leagues:match_create' pk=league.pk %}"
         class="inline-flex items-center gap-2 h-10 px-5 rounded-xl bg-green-500/20 text-green-400 border border-green-500/30 hover:bg-green-500/30 transition font-bold uppercase text-xs tracking-wider">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M12 4v16m8-8H4"/></svg>
        Add Match
      </a>
    </div>
  {% endif %}

  <div class="bg-[#2A1B54]/60 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden shadow-2xl">
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left whitespace-nowrap">
        <thead class="bg-black/30 text-xs font-bold uppercase text-gray-400">
          <tr>
            <th class="px-6 py-4">Date</th>
            <th class="px-6 py-4 text-right">Home</th>
            <th class="px-4 py-4 text-center">Score</th>
            <th class="px-6 py-4 text-left">Away</th>
            <th class="px-6 py-4 text-center">Status</th>
            {% if request.user.is_authenticated and request.user.profile.is_content_staff %}
              <th class="px-6 py-4 text-right">Action</th>
            {% endif %}
          </tr>
        </thead>
        <tbody class="divide-y divide-white/5">
        {% for m in matches %}
            <tr class="hover:bg-white/5 transition-colors group">

            <td class="px-6 py-4 text-gray-400 font-mono text-xs">
                <a href="{% url 'leagues:match_detail' match_id=m.pk %}" class="hover:text-white transition">
                {{ m.date|date:"d M Y, H:i" }}
                </a>
            </td>

            <td class="px-6 py-4 font-bold text-white text-right">
                {% if m.home_team_id %}
                <a href="{% url 'leagues:team_detail' team_id=m.home_team_id %}" class="hover:text-secondary transition flex items-center justify-end gap-3">
                    {{ m.home_team.name }}
                    {% if m.home_team.logo_url %}
                        <img src="{{ m.home_team.logo_url }}" class="h-6 w-6 object-contain" alt="">
                    {% endif %}
                </a>
                {% else %}
                <span class="text-gray-500 italic">{{ m.home_team.name|default:"Unknown" }}</span>
                {% endif %}
            </td>

            <td class="px-4 py-4 text-center">
                {% if m.status == "FINISHED" %}
                <span class="inline-flex items-center justify-center bg-[#1A103C] border border-white/10 rounded-lg px-3 py-1.5 min-w-[60px] text-lg font-extrabold text-white tracking-widest shadow-inner">
                    {{ m.home_score }} - {{ m.away_score }}
                </span>
                {% else %}
                <span class="text-gray-600 font-mono">v.s</span>
                {% endif %}
            </td>

            <td class="px-6 py-4 font-bold text-white text-left">
                {% if m.away_team_id %}
                <a href="{% url 'leagues:team_detail' team_id=m.away_team_id %}" class="hover:text-secondary transition flex items-center justify-start gap-3">
                    {% if m.away_team.logo_url %}
                        <img src="{{ m.away_team.logo_url }}" class="h-6 w-6 object-contain" alt="">
                    {% endif %}
                    {{ m.away_team.name }}
                </a>
                {% else %}
                <span class="text-gray-500 italic">{{ m.away_team.name|default:"Unknown" }}</span>
                {% endif %}
            </td>

            <td class="px-6 py-4 text-center">
                {% if m.status == 'FINISHED' %}
                    <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase bg-white/10 text-gray-300 border border-white/5">
                        FT
                    </span>
                {% else %}
                    <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase bg-primary/10 text-primary border border-primary/20">
                        Upcoming
                    </span>
                {% endif %}
            </td>

            {% if request.user.is_authenticated and request.user.profile.is_content_staff %}
              <td class="px-6 py-4 text-right">
                <a href="{% url 'leagues:match_update' match_id=m.pk %}" class="text-xs font-bold text-gray-400 hover:text-white uppercase tracking-wider bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-lg transition border border-white/5">
                    Edit
                </a>
              </td>
            {% endif %}

            </tr>
        {% empty %}
            <tr>
              <td colspan="{% if request.user.is_authenticated and request.user.profile.is_content_staff %}6{% else %}5{% endif %}" class="px-6 py-12 text-center text-gray-500 italic bg-black/20">
                No matches found for the selected filter.
              </td>
            </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="flex items-center justify-between pt-4 border-t border-white/10">
    <div class="text-sm text-gray-400">
      Page <span class="font-bold text-white">{{ page_obj.number }}</span> of <span class="font-bold text-white">{{ page_obj.paginator.num_pages }}</span>
    </div>
    <div class="flex items-center gap-2">
      {% if page_obj.has_previous %}
        <a href="?tab={{ active_tab }}&team={{ team_q }}&from={{ from_q }}&to={{ to_q }}&page={{ page_obj.previous_page_number }}"
           class="h-9 px-4 rounded-lg border border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 hover:text-white transition text-sm font-medium flex items-center">
          ← Prev
        </a>
      {% endif %}
      {% if page_obj.has_next %}
        <a href="?tab={{ active_tab }}&team={{ team_q }}&from={{ from_q }}&to={{ to_q }}&page={{ page_obj.next_page_number }}"
           class="h-9 px-4 rounded-lg border border-white/10 bg-white/5 text-gray-300 hover:bg-white/10 hover:text-white transition text-sm font-medium flex items-center">
          Next →
        </a>
      {% endif %}
    </div>
  </div>
  
</section>
{% endblock %}