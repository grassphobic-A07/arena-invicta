{% comment %} nav.html - Quiz Only for Logged In Users {% endcomment %}
<header class="sticky top-0 z-50 w-full border-b border-white/10 bg-[#1A103C]/90 backdrop-blur-md shadow-lg">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">

      {% comment %} --- URL Definitions --- {% endcomment %}
      {% url 'news:show_news' as home_url %}
      {% url 'leagues:league_list' as league_url %}
      {% url 'discussions:thread-list' as discussion_url %}
      {% url 'quiz:show_main' as quiz_url %}
      {% url 'accounts:login' as login_url %}
      {% url 'accounts:register' as register_url %}
      {% url 'accounts:logout' as logout_url %}

      {% comment %} === BRAND === {% endcomment %}
      <div class="flex-shrink-0">
        <a href="{{ home_url }}" class="font-extrabold text-2xl tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white via-primary to-secondary hover:opacity-80 transition">
          Arena Invicta
        </a>
      </div>

      {% comment %} === DESKTOP MENU (Hidden on Mobile) === {% endcomment %}
      <nav class="hidden md:flex space-x-1">
        <a href="{{ home_url }}" class="px-3 py-2 rounded-lg text-sm font-medium transition-colors {% if request.resolver_match.app_name == 'news' %}bg-white/10 text-white shadow-inner{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">Home</a>
        <a href="{{ discussion_url }}" class="px-3 py-2 rounded-lg text-sm font-medium transition-colors {% if request.resolver_match.app_name == 'discussions' %}bg-white/10 text-white shadow-inner{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">Discussions</a>
        <a href="{{ league_url }}" class="px-3 py-2 rounded-lg text-sm font-medium transition-colors {% if request.resolver_match.app_name == 'leagues' %}bg-white/10 text-white shadow-inner{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">League</a>
        
        {% if request.user.is_authenticated %}
            <a href="{{ quiz_url }}" class="px-3 py-2 rounded-lg text-sm font-medium transition-colors {% if request.resolver_match.app_name == 'quiz' %}bg-white/10 text-white shadow-inner{% else %}text-gray-300 hover:bg-white/5 hover:text-white{% endif %}">Quiz</a>
        {% endif %}
      </nav>

      {% comment %} === RIGHT SECTION (Auth) === {% endcomment %}
      <div class="hidden md:flex items-center gap-4">
        {% if request.user.is_authenticated %}
          {% if request.user.username == 'arena_admin' %}
            <a href="{% url 'accounts:admin_dashboard' %}" class="px-3 py-1 text-xs font-bold uppercase tracking-wide border border-secondary text-secondary rounded-full hover:bg-secondary hover:text-white transition">Admin</a>
          {% endif %}

          <div class="relative ml-2">
            <button id="user-menu-button" class="relative flex items-center focus:outline-none group">
                <div class="h-9 w-9 rounded-full border-2 border-white/20 bg-black/40 overflow-hidden group-hover:border-white/50 transition">
                    {% if request.user.profile.avatar_url %}
                        <img src="{{ request.user.profile.avatar_url }}" class="h-full w-full object-cover" onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                        <div class="hidden h-full w-full grid place-items-center text-xs font-bold text-white">{{ request.user.username|slice:":1"|upper }}</div>
                    {% else %}
                        <div class="h-full w-full grid place-items-center text-xs font-bold text-white">{{ request.user.username|slice:":1"|upper }}</div>
                    {% endif %}
                </div>
                <div class="absolute -bottom-1 -right-1 bg-[#1A103C] rounded-full p-0.5">
                    <div class="bg-secondary text-white rounded-full w-4 h-4 flex items-center justify-center shadow-sm">
                        <svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="3" d="M19 9l-7 7-7-7"/></svg>
                    </div>
                </div>
            </button>

            <div id="user-menu" class="hidden absolute right-0 mt-3 w-56 origin-top-right rounded-xl bg-[#2A1B54] border border-white/10 shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none z-50 transform transition-all">
                <div class="px-4 py-3 border-b border-white/10">
                    <p class="text-xs text-gray-400">Signed in as</p>
                    <p class="text-sm font-bold text-white truncate">{{ request.user.username }}</p>
                </div>
                <div class="py-1">
                    <a href="{% url 'accounts:profile_detail' request.user.username %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white">My Profile</a>
                    <a href="{{ quiz_url }}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-white/10 hover:text-white">Quiz Arena</a> 
                </div>
                <div class="border-t border-white/10 py-1">
                    <a href="{{ logout_url }}" class="block px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 hover:text-red-300">Sign out</a>
                </div>
            </div>
          </div>
        {% else %}
          <a href="{{ login_url }}" class="text-sm font-medium text-gray-300 hover:text-white transition">Log in</a>
          <a href="{{ register_url }}" class="px-4 py-2 rounded-lg bg-primary text-white text-sm font-bold shadow-lg hover:bg-primary/90 transition transform hover:-translate-y-0.5">Sign Up</a>
        {% endif %}
      </div>

      {% comment %} === MOBILE MENU BUTTON === {% endcomment %}
      <div class="flex md:hidden">
        <button id="nav-toggle" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-white/10 focus:outline-none">
          <span class="sr-only">Open main menu</span>
          <svg id="icon-menu" class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg id="icon-close" class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  {% comment %} === MOBILE MENU CONTENT === {% endcomment %}
  <div id="mobile-sheet" class="hidden md:hidden bg-[#1A103C] border-b border-white/10 shadow-2xl animate-in slide-in-from-top-5 duration-200">
    <div class="px-4 pt-2 pb-6 space-y-2">
      
      <a href="{{ home_url }}" class="block px-4 py-3 rounded-lg text-base font-medium text-white hover:bg-white/10 border border-transparent hover:border-white/5 transition">
        Home
      </a>
      <a href="{{ discussion_url }}" class="block px-4 py-3 rounded-lg text-base font-medium text-white hover:bg-white/10 border border-transparent hover:border-white/5 transition">
        Discussions
      </a>
      <a href="{{ league_url }}" class="block px-4 py-3 rounded-lg text-base font-medium text-white hover:bg-white/10 border border-transparent hover:border-white/5 transition">
        League
      </a>

      {% if request.user.is_authenticated %}
        <a href="{{ quiz_url }}" class="block px-4 py-3 rounded-lg text-base font-medium text-yellow-400 hover:bg-yellow-400/10 border border-transparent hover:border-yellow-400/20 transition flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
            Quiz Arena
        </a>
      {% endif %}

      <div class="pt-4 mt-4 border-t border-white/10">
        {% if request.user.is_authenticated %}
          <div class="flex items-center px-4 mb-4">
            <div class="flex-shrink-0">
                {% if request.user.profile.avatar_url %}
                    <img class="h-10 w-10 rounded-full object-cover border border-white/20" src="{{ request.user.profile.avatar_url }}" alt="">
                {% else %}
                    <div class="h-10 w-10 rounded-full bg-surface grid place-items-center font-bold text-white border border-white/20">{{ request.user.username|slice:":1"|upper }}</div>
                {% endif %}
            </div>
            <div class="ml-3">
              <div class="text-base font-medium leading-none text-white">{{ request.user.username }}</div>
              <div class="text-sm font-medium leading-none text-gray-400 mt-1">Logged In</div>
            </div>
          </div>
          
          <a href="{% url 'accounts:profile_detail' request.user.username %}" class="block px-4 py-2 rounded-lg text-base font-medium text-gray-300 hover:text-white hover:bg-white/10">Your Profile</a>
          
          {% if request.user.username == 'arena_admin' %}
             <a href="{% url 'accounts:admin_dashboard' %}" class="block px-4 py-2 rounded-lg text-base font-medium text-secondary hover:bg-secondary/10">Admin Dashboard</a>
          {% endif %}

          <a href="{{ logout_url }}" class="block px-4 py-2 rounded-lg text-base font-medium text-red-400 hover:text-red-300 hover:bg-red-500/10">Sign out</a>
        {% else %}
          <div class="grid grid-cols-2 gap-4 px-2">
              <a href="{{ login_url }}" class="flex items-center justify-center px-4 py-2 border border-white/10 rounded-lg text-base font-medium text-white hover:bg-white/5">Log in</a>
              <a href="{{ register_url }}" class="flex items-center justify-center px-4 py-2 border border-transparent rounded-lg text-base font-medium text-white bg-primary hover:bg-primary/90">Sign up</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</header>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Toggle Mobile Menu
        const navToggle = document.getElementById('nav-toggle');
        const mobileSheet = document.getElementById('mobile-sheet');
        const iconMenu = document.getElementById('icon-menu');
        const iconClose = document.getElementById('icon-close');

        if(navToggle && mobileSheet){
            navToggle.addEventListener('click', () => {
                const isHidden = mobileSheet.classList.contains('hidden');
                if(isHidden){
                    mobileSheet.classList.remove('hidden');
                    iconMenu.classList.add('hidden');
                    iconClose.classList.remove('hidden');
                } else {
                    mobileSheet.classList.add('hidden');
                    iconMenu.classList.remove('hidden');
                    iconClose.classList.add('hidden');
                }
            });
        }

        // Toggle Desktop User Dropdown
        const userBtn = document.getElementById('user-menu-button');
        const userMenu = document.getElementById('user-menu');

        if(userBtn && userMenu){
            userBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                userMenu.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!userBtn.contains(e.target) && !userMenu.contains(e.target)) {
                    userMenu.classList.add('hidden');
                }
            });
        }
    });
</script>